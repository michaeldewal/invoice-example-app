{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/space:template-controller/source/template-controller.js","filenameRelative":"/packages/space:template-controller/source/template-controller.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/space:template-controller/source/template-controller.js.map","sourceFileName":"/packages/space:template-controller/source/template-controller.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"template-controller"},"ignored":false,"code":"var DEFAULT_API = ['state', 'props', 'helpers', 'events', 'onCreated', 'onRendered', 'onDestroyed'];\n\n// Helpers\nvar withTemplateInstanceContext = function withTemplateInstanceContext(handler) {\n  return function () {\n    return handler.apply(Template.instance(), arguments);\n  };\n};\n\nvar bindToTemplateInstance = function bindToTemplateInstance(handlers) {\n  for (var _iterator = Object.keys(handlers), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n    var _ref;\n\n    if (_isArray) {\n      if (_i >= _iterator.length) break;\n      _ref = _iterator[_i++];\n    } else {\n      _i = _iterator.next();\n      if (_i.done) break;\n      _ref = _i.value;\n    }\n\n    var key = _ref;\n\n    handlers[key] = withTemplateInstanceContext(handlers[key]);\n  }\n  return handlers;\n};\n\nvar generateReactiveAccessor = function generateReactiveAccessor(defaultValue) {\n  var value = new ReactiveVar(defaultValue);\n  return function (newValue) {\n    if (newValue !== undefined) {\n      value.set(newValue);\n    } else {\n      return value.get();\n    }\n  };\n};\n\n// Errors\nvar templateNotFoundError = function templateNotFoundError(templateName) {\n  var error = new Error('No template <' + templateName + '> found.');\n  error.name = 'TemplateNotFoundError';\n  return error;\n};\n\nvar propertyValidatorRequired = function propertyValidatorRequired() {\n  var error = new Error('<data> must be a validator with #clean and #validate methods (see: SimpleSchema)');\n  error.name = 'PropertyValidatorRequired';\n  return error;\n};\n\nvar propertyValidationError = function propertyValidationError(error, templateName) {\n  error.name = 'PropertyValidationError';\n  error.message = 'in <' + templateName + '> ' + error.message;\n  return error;\n};\n\nvar rootElementRequired = function rootElementRequired() {\n  var error = new Error('Please define a single root DOM element for your template.\\n' + 'Learn more about this issue: https://github.com/meteor-space/template-controller/issues/6');\n  error.name = 'RootElementRequired';\n  return error;\n};\n\n// We have to make it a global to support Meteor 1.2.x\nTemplateController = function TemplateController(templateName, config) {\n  // Template reference\n  var template = Template[templateName];\n  if (!template) {\n    throw templateNotFoundError(templateName);\n  }\n  var state = config.state;\n  var props = config.props;\n  var helpers = config.helpers;\n  var events = config.events;\n  var onCreated = config.onCreated;\n  var onRendered = config.onRendered;\n  var onDestroyed = config.onDestroyed;\n\n  // Remove all standard api props fromt he config so we can have add the\n  // rest to the template instance!\n\n  for (var _iterator2 = DEFAULT_API, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n    if (_isArray2) {\n      if (_i2 >= _iterator2.length) break;\n      apiProp = _iterator2[_i2++];\n    } else {\n      _i2 = _iterator2.next();\n      if (_i2.done) break;\n      apiProp = _i2.value;\n    }\n\n    delete config[apiProp];\n  }\n\n  // State & private instance methods\n  template.onCreated(function () {\n    var _this = this;\n\n    if (state) {\n      this.state = {};\n      // Setup the state as reactive vars\n      for (var _iterator3 = Object.keys(state), _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n        var _ref2;\n\n        if (_isArray3) {\n          if (_i3 >= _iterator3.length) break;\n          _ref2 = _iterator3[_i3++];\n        } else {\n          _i3 = _iterator3.next();\n          if (_i3.done) break;\n          _ref2 = _i3.value;\n        }\n\n        var key = _ref2;\n\n        this.state[key] = generateReactiveAccessor(state[key]);\n      }\n    }\n    // Private\n    if (config['private']) {\n      for (var _iterator4 = Object.keys(config['private']), _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n        var _ref3;\n\n        if (_isArray4) {\n          if (_i4 >= _iterator4.length) break;\n          _ref3 = _iterator4[_i4++];\n        } else {\n          _i4 = _iterator4.next();\n          if (_i4.done) break;\n          _ref3 = _i4.value;\n        }\n\n        var _key = _ref3;\n\n        this[_key] = config['private'][_key];\n      }\n    }\n    // Add sugar method for triggering custom jQuery events on the root node\n    this.triggerEvent = function (eventName, data) {\n      // Force best practice of having a single root element for components!\n      if (_this.firstNode !== _this.lastNode) throw rootElementRequired();\n      _this.$(_this.firstNode).trigger(eventName, data);\n    };\n  });\n\n  // Default values for props\n  if (props) {\n    template.onCreated(function () {\n      var _this2 = this;\n\n      this.props = {};\n      this.autorun(function () {\n        if (!props.validate) throw propertyValidatorRequired();\n        var currentData = Template.currentData() || {};\n        props.clean(currentData);\n        try {\n          props.validate(currentData);\n        } catch (error) {\n          throw propertyValidationError(error, _this2.view.name);\n        }\n        for (var _iterator5 = Object.keys(currentData), _isArray5 = Array.isArray(_iterator5), _i5 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {\n          var _ref4;\n\n          if (_isArray5) {\n            if (_i5 >= _iterator5.length) break;\n            _ref4 = _iterator5[_i5++];\n          } else {\n            _i5 = _iterator5.next();\n            if (_i5.done) break;\n            _ref4 = _i5.value;\n          }\n\n          var key = _ref4;\n\n          var value = currentData[key];\n          if (!_this2.props[key]) {\n            _this2.props[key] = generateReactiveAccessor(value);\n          } else {\n            _this2.props[key](value);\n          }\n        }\n      });\n    });\n  }\n  // Helpers\n  if (!helpers) helpers = {};\n  helpers.state = function () {\n    return this.state;\n  };\n  helpers.props = function () {\n    return this.props;\n  };\n  template.helpers(bindToTemplateInstance(helpers));\n\n  // Events\n  if (events) {\n    template.events(bindToTemplateInstance(events));\n  }\n\n  // Lifecycle\n  if (onCreated) template.onCreated(onCreated);\n  if (onRendered) template.onRendered(onRendered);\n  if (onDestroyed) template.onDestroyed(onDestroyed);\n};","ast":null,"map":{"version":3,"sources":["/packages/space:template-controller/source/template-controller.js"],"names":[],"mappings":"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","file":"/packages/space:template-controller/source/template-controller.js.map","sourcesContent":["const DEFAULT_API = [\n  'state', 'props', 'helpers', 'events', 'onCreated', 'onRendered', 'onDestroyed'\n];\n\n// Helpers\nconst withTemplateInstanceContext = function(handler) {\n  return function() {\n    return handler.apply(Template.instance(), arguments);\n  };\n};\n\nconst bindToTemplateInstance = function(handlers) {\n  for (let key of Object.keys(handlers)) {\n    handlers[key] = withTemplateInstanceContext(handlers[key]);\n  }\n  return handlers;\n};\n\nconst generateReactiveAccessor = function(defaultValue) {\n  let value = new ReactiveVar(defaultValue);\n  return function(newValue) {\n    if (newValue !== undefined) {\n      value.set(newValue);\n    } else {\n      return value.get();\n    }\n  };\n};\n\n// Errors\nconst templateNotFoundError = function(templateName) {\n  let error = new Error(`No template <${templateName}> found.`);\n  error.name = 'TemplateNotFoundError';\n  return error;\n};\n\nconst propertyValidatorRequired = function() {\n  let error = new Error(\n    '<data> must be a validator with #clean and #validate methods (see: SimpleSchema)'\n  );\n  error.name = 'PropertyValidatorRequired';\n  return error;\n};\n\nconst propertyValidationError = function(error, templateName) {\n  error.name = 'PropertyValidationError';\n  error.message = `in <${templateName}> ` + error.message;\n  return error;\n};\n\nconst rootElementRequired = function() {\n  let error = new Error(\n    'Please define a single root DOM element for your template.\\n' +\n    'Learn more about this issue: https://github.com/meteor-space/template-controller/issues/6'\n  );\n  error.name = 'RootElementRequired';\n  return error;\n};\n\n// We have to make it a global to support Meteor 1.2.x\nTemplateController = function(templateName, config) {\n  // Template reference\n  let template = Template[templateName];\n  if (!template) {\n    throw templateNotFoundError(templateName);\n  }\n  let { state, props, helpers, events, onCreated, onRendered, onDestroyed } = config;\n\n  // Remove all standard api props fromt he config so we can have add the\n  // rest to the template instance!\n  for (apiProp of DEFAULT_API) {\n    delete config[apiProp];\n  }\n\n  // State & private instance methods\n  template.onCreated(function() {\n    if (state) {\n      this.state = {};\n      // Setup the state as reactive vars\n      for (let key of Object.keys(state)) {\n        this.state[key] = generateReactiveAccessor(state[key]);\n      }\n    }\n    // Private\n    if (config.private) {\n      for (let key of Object.keys(config.private)) {\n        this[key] = config.private[key];\n      }\n    }\n    // Add sugar method for triggering custom jQuery events on the root node\n    this.triggerEvent = (eventName, data) => {\n      // Force best practice of having a single root element for components!\n      if (this.firstNode !== this.lastNode) throw rootElementRequired();\n      this.$(this.firstNode).trigger(eventName, data);\n    };\n  });\n\n  // Default values for props\n  if (props) {\n    template.onCreated(function() {\n      this.props = {};\n      this.autorun(() => {\n        if (!props.validate) throw propertyValidatorRequired();\n        let currentData = Template.currentData() || {};\n        props.clean(currentData);\n        try {\n          props.validate(currentData);\n        } catch (error) {\n          throw propertyValidationError(error, this.view.name);\n        }\n        for (let key of Object.keys(currentData)) {\n          let value = currentData[key];\n          if (!this.props[key]) {\n            this.props[key] = generateReactiveAccessor(value);\n          } else {\n            this.props[key](value);\n          }\n        }\n      });\n    });\n  }\n  // Helpers\n  if (!helpers) helpers = {};\n  helpers.state = function() { return this.state; };\n  helpers.props = function() { return this.props; };\n  template.helpers(bindToTemplateInstance(helpers));\n\n  // Events\n  if (events) {\n    template.events(bindToTemplateInstance(events));\n  }\n\n  // Lifecycle\n  if (onCreated) template.onCreated(onCreated);\n  if (onRendered) template.onRendered(onRendered);\n  if (onDestroyed) template.onDestroyed(onDestroyed);\n\n};\n"]},"hash":"584c75659ad828f53c255c59bdd879d707aa8f0a"}
